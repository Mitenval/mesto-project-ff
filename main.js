(()=>{"use strict";var e="card__like-button_is-active";function t(e,t,c,i,u,a){var l=c.cloneNode(!0).querySelector(".card"),s=l.querySelector(".card__image"),f=l.querySelector(".card__like-button"),d=l.querySelector(".card__like-counter"),p=l.querySelector(".card__delete-button");return s.setAttribute("src",e.link),s.setAttribute("alt",e.name),o(d,e),s.addEventListener("click",(function(){a(e)})),r(f,e,t),f.addEventListener("click",(function(){var c=n(e,t);u(e,c).then((function(n){e.likes=n.newCardInfo.likes,r(f,n.newCardInfo,t),o(d,n.newCardInfo)}))})),l.querySelector(".card__title").textContent=e.name,e.owner._id===t?p.addEventListener("click",(function(){i(e._id).then((function(){l.remove()}))})):p.classList.add("card__delete-button--hidden"),l}function r(t,r,o){n(r,o)?t.classList.add(e):t.classList.remove(e)}function n(e,t){return e.likes.some((function(e){return e._id===t}))}function o(e,t){e.textContent=t.likes.length}var c,i="popup_is-opened";function u(e){e.classList.add(i)}function a(){document.querySelector(".".concat(i)).classList.remove(i)}function l(){p(),a()}function s(e){e.currentTarget===e.target&&(p(),a())}function f(e){"Escape"===e.key&&(p(),a())}function d(e){c=e.querySelector(".popup__close"),document.addEventListener("keydown",f),c.addEventListener("click",l),document.querySelector(".".concat(i)).addEventListener("click",s)}function p(){document.removeEventListener("keydown",f),c.removeEventListener("click",l),document.querySelector(".".concat(i)).removeEventListener("click",s),c=void 0}var m=["formSelector"],y=function(e,t,r,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r),o.classList.remove(n),o.textContent=""},v=function(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(r),t.disabled=!1):(t.classList.add(r),t.disabled=!0)};function b(e,t){var r=t.inputSelector,n=t.submitButtonSelector,o=t.inactiveButtonClass,c=t.inputErrorClass,i=t.errorClass,u=Array.from(e.querySelectorAll(r)),a=e.querySelector(n);v(u,a,o),u.forEach((function(t){y(e,t,c,i)}))}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var h={baseUrl:"https://nomoreparties.co/v1/".concat("wff-cohort-24"),headers:{authorization:"3fda53f6-cae9-47b1-9be0-ea783f14a9a7","Content-Type":"application/json"}};function S(e){return E(fetch("".concat(h.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:h.headers}))}function E(e){return e.then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function L(e,t,r){return(t=function(e){var t=function(e){if("object"!=g(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=g(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==g(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var k,O=document.querySelector("#card-template").content,j=document.querySelector(".popup_type_image"),w=document.querySelector(".popup_type_edit"),A=document.querySelector(".popup_type_new-card"),P=document.querySelector(".popup_type_avatar"),x=document.querySelector(".places__list"),I=document.querySelector(".profile__edit-button"),T=document.querySelector(".profile__add-button"),U=document.querySelector(".profile__title"),D=document.querySelector(".profile__description"),B=A.querySelector('.popup__form[name="new-place"]'),N=document.querySelector('.popup__form[name="edit-profile"]'),J=P.querySelector('.popup__form[name="edit-profile"]'),M=N.elements.name,G=N.elements.description,H=J.elements.link,$=document.querySelector(".profile__image"),z={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},F="Сохранение...",K="Сохранить";function Q(e){e.preventDefault();var t,r,n=N.querySelector(".popup__button");n.textContent=F,U.textContent=M.value,D.textContent=G.value,p(),a(),(t=M.value,r=G.value,E(fetch("".concat(h.baseUrl,"/users/me"),{method:"PATCH",headers:h.headers,body:JSON.stringify({name:t,about:r})}))).finally((function(){n.textContent=K})),N.removeEventListener("submit",Q)}function R(e){e.preventDefault();var r=B.elements["place-name"].value,n=B.elements.link.value,o=B.querySelector(".popup__button");o.textContent=F,function(e,t){return E(fetch("".concat(h.baseUrl,"/cards"),{method:"POST",headers:h.headers,body:JSON.stringify({name:e,link:t})}))}(r,n).then((function(e){var r=t(e,k,O,S,Y,W);x.prepend(r),p(),a()})).catch((function(e){console.error("Ошибка добавления карточки:",e)})).finally((function(){B.removeEventListener("submit",R),o.textContent=K}))}function V(e){e.preventDefault();var t,r=J.querySelector(".popup__button");r.textContent=F,(t=H.value,E(fetch("".concat(h.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:h.headers,body:JSON.stringify({avatar:t})}))).then((function(e){$.src=e.avatar,p(),a()})).catch((function(e){return console.error("Ошибка обновления аватара:",e)})).finally((function(){J.removeEventListener("submit",V),r.textContent=K}))}function W(e){u(j),d(j);var t=j.querySelector(".popup__image");t.setAttribute("src",e.link),t.setAttribute("alt",e.name),j.querySelector(".popup__caption").textContent=e.name}function X(){b(P.querySelector(".popup__form"),z),u(P),d(P)}function Y(e,t){return t?(r=e._id,E(fetch("".concat(h.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:h.headers}))).then((function(e){return{isLiked:t,newCardInfo:e}})):function(e){return E(fetch("".concat(h.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:h.headers}))}(e._id).then((function(e){return{isLiked:t,newCardInfo:e}}));var r}I.addEventListener("click",(function(){M.value=U.textContent,G.value=D.textContent,b(w.querySelector(".popup__form"),z),u(w),d(w),N.addEventListener("submit",Q)})),T.addEventListener("click",(function(){B.reset(),b(A.querySelector(".popup__form"),z),u(A),d(A),B.addEventListener("submit",R)})),$.addEventListener("click",(function(){J.reset(),X(),J.addEventListener("submit",V)})),function(e){var t=e.formSelector,r=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.includes(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)r=c[n],t.includes(r)||{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,m);Array.from(document.querySelectorAll(t)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var r=t.inputSelector,n=t.submitButtonSelector,o=t.inactiveButtonClass,c=t.inputErrorClass,i=t.errorClass,u=Array.from(e.querySelectorAll(r)),a=e.querySelector(n);v(u,a,o),u.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,r,n){t.validity.valid?y(e,t,r,n):function(e,t,r,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r),o.classList.add(n),o.textContent=t.validationMessage}(e,t,r,n)}(e,t,c,i),v(u,a,o)}))}))}(e,r)}))}(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach((function(t){L(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({formSelector:".popup__form"},z)),$.addEventListener("click",X),Promise.all([fetch("".concat(h.baseUrl,"/users/me"),{method:"GET",headers:h.headers}),fetch("".concat(h.baseUrl,"/cards"),{method:"GET",headers:h.headers})]).then((function(e){var t,r,n=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,c,i,u=[],a=!0,l=!1;try{if(c=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;a=!1}else for(;!(a=(n=c.call(r)).done)&&(u.push(n.value),u.length!==t);a=!0);}catch(e){l=!0,o=e}finally{try{if(!a&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return u}}(t,r)||function(e,t){if(e){if("string"==typeof e)return _(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=n[0],c=n[1];return o.ok&&c.ok?Promise.all([o.json(),c.json()]):Promise.reject("Ошибка при загрузке данных")})).catch((function(e){console.error(e)})).then((function(e){var r,n,o=(n=2,function(e){if(Array.isArray(e))return e}(r=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,c,i,u=[],a=!0,l=!1;try{if(c=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;a=!1}else for(;!(a=(n=c.call(r)).done)&&(u.push(n.value),u.length!==t);a=!0);}catch(e){l=!0,o=e}finally{try{if(!a&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return u}}(r,n)||function(e,t){if(e){if("string"==typeof e)return q(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?q(e,t):void 0}}(r,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],i=o[1];k=c._id,U.textContent=c.name,D.textContent=c.about,$.style.backgroundImage="url('".concat(c.avatar,"')"),i.forEach((function(e){var r=t(e,k,O,S,Y,W);x.append(r)}))}))})();